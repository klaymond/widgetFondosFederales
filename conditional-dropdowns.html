<!DOCTYPE html>
<html>

<head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
</head>

<body>
    <div id="main">
        <h3>Selecciona los bienes y los montos por asignar</h3>
        <table id="answers">
            <tr>
                <th>Eje</th>
                <th>Programa</th>
                <th>Subprograma</th>
                <th>Capítulo</th>
                <th>Concepto</th>
                <th>Partida</th>
                <th>Bien</th>
                <th>Federal</th>
                <th>Federal - Municipal</th>
                <th>Estatal</th>
                <th>Estatal - Municipal</th>
            </tr>
        </table>
        <button onclick="addNewRow()">Agrega otro bien</button>
    </div>
    <script type="text/javascript">
        //always subscribe to ready event and implement widget related code
        //inside callback function , it is the best practice while developing widgets
        JFCustomWidget.subscribe("ready", function () {
            var label = JFCustomWidget.getWidgetSetting('QuestionLabel');
            document.getElementById('labelText').innerHTML = label;
            //subscribe to form submit event
            JFCustomWidget.subscribe("submit", function () {
                var msg = {
                    //you should valid attribute to data for JotForm
                    //to be able to use youw widget as required
                    valid: true,
                    value: document.getElementById('userInput').value
                }
                // send value to JotForm
                JFCustomWidget.sendSubmit(msg);
            });
        });
    </script>
    <script>
        var subprogramaObject = {
            "2 - Evaluaciones de Control de Confianza para las Instituciones de Seguridad Pública: Aspirantes y Permanencia": {
                "121 - Honorarios Asimilables A Salarios": ["771 - Honorarios"],
                "371 - Pasajes Aéreos": ["1114 - Pasajes aéreos nacionales"],
                "515 - Equipo De Cómputo Y De Tecnologías De La Información": ["338 - Computadora de escritorio", "342 - Computadora portátil", "618 - Escáner", "785 - Impresora", "1036 - Monitor", "1059 - Multifuncional", "1157 - Polígrafo", "1517 - Unidad de protección y respaldo de energía (UPS)", "1514 - Unidad de almacenamiento de datos"]
            },
            "3 - Capacitaciones de Formación Inicial y Continua conforme al Programa Rector": {
                "211 - Materiales, Útiles Y Equipos Menores De Oficina": ["931 - Materiales y Útiles de oficina"],
                "334 - Servicios De Capacitación": ["479 - Curso de capacitación para Policía Estatal_Formación Inicial (Aspirantes)", "473 - Curso de capacitación para Policía Estatal_Formación Continua", "486 - Curso de capacitación para Policía Municipal_Formación Inicial (Aspirantes)", "480 - Curso de capacitación para Policía Municipal_Formación Continua", "472 - Curso de capacitación para Policía de Investigación_Formación Inicial (Aspirantes)", "471 - Curso de capacitación para Policía de Investigación_Formación Inicial (Activos)", "466 - Curso de capacitación para Policía de Investigación_Formación Continua", "447 - Curso de capacitación para Perito_Formación Continua", "439 - Curso de capacitación para Agente del Ministerio Público_Formación Inicial (Activos)", "434 - Curso de capacitación para Agente del Ministerio Público_Formación Continua", "463 - Curso de capacitación para Personal del Sistema Penitenciario_Formación Inicial (Aspirantes)", "455 - Curso de capacitación para Personal del Sistema Penitenciario_Formación Continua"]
            }
        }

        var ejeObject = {
            "2": ["1", "1"],
            "3": ["2", "3"]
        }
        let clickCount = 0;
        function addNewRow() {
            const tableBody = document.getElementById('answers').getElementsByTagName('tbody')[0];
            const sourceRow = document.getElementById('sourceRow');

            // Clone the source row, including its content
            const idx = clickCount;
            const newRow = document.createElement('tr');
            const ejeCell = document.createElement('td');
            ejeCell.id = `ejeData${idx}`;
            const programaCell = document.createElement('td');
            programaCell.id = `programaData${idx}`;
            const subprogramaCell = document.createElement('td');
            subprogramaCell.id = `subprogramaData${idx}`;
            const selectSubprograma = document.createElement('select');
            selectSubprograma.id = `subprogramaSelect${idx}`;
            selectSubprograma.options[0] = new Option("Seleccione un subprograma", "", true);
            subprogramaCell.appendChild(selectSubprograma);
            for (var x in subprogramaObject) {
                selectSubprograma.options[selectSubprograma.options.length] = new Option(x, x.split(" - ")[0]);
            }
            const capituloCell = document.createElement('td');
            capituloCell.id = `capituloData${idx}`;
            const conceptoCell = document.createElement('td');
            conceptoCell.id = `conceptoData${idx}`;
            const partidaCell = document.createElement('td');
            partidaCell.id = `partidaData${idx}`;
            const selectPartida = document.createElement('select');
            selectPartida.id = `partidaSelect${idx}`;
            selectPartida.options[0] = new Option("Seleccione un subprograma", "", true);
            partidaCell.appendChild(selectPartida);
            const bienCell = document.createElement('td');
            bienCell.id = `bienData${idx}`;
            const selectBien = document.createElement('select');
            selectBien.id = `bienSelect${idx}`;
            selectBien.options[0] = new Option("Seleccione una partida", "", true);
            bienCell.appendChild(selectBien);
            const federalCell = document.createElement('td');
            federalCell.id = `federalData${idx}`;
            var federalInput = document.createElement("input");
            federalInput.type = "text";
            federalInput.min = "0.00";
            federalInput.step = "0.01";
            federalCell.appendChild(federalInput)
            const federalMunicipalCell = document.createElement('td');
            var federalMunicipalInput = document.createElement("input");
            federalMunicipalInput.type = "text";
            federalMunicipalInput.min = "0.00";
            federalMunicipalInput.step = "0.01";
            federalMunicipalCell.id = `federalMunicipalData${idx}`;
            federalMunicipalCell.appendChild(federalMunicipalInput);
            const estatalCell = document.createElement('td');
            estatalCell.id = `estatalData${idx}`;
            var estatalInput = document.createElement("input");
            estatalInput.type = "text";
            estatalInput.min = "0.00";
            estatalInput.step = "0.01";
            estatalCell.appendChild(estatalInput);
            const estatalMunicipalCell = document.createElement('td');
            estatalMunicipalCell.id = `estatalMunicipalData${idx}`;
            var estatalMunicipalInput = document.createElement("input");
            estatalMunicipalInput.type = "text";
            estatalMunicipalInput.min = "0.00";
            estatalMunicipalInput.step = "0.01";
            estatalMunicipalCell.appendChild(estatalMunicipalInput);

            selectSubprograma.onchange = function () {
                //empty biens- and partidas- dropdowns
                selectBien.length = 1;
                selectPartida.length = 1;
                // Fill Eje and programa
                if (this.value) {
                    ejeCell.innerHTML = ejeObject[this.value][0]
                    programaCell.innerHTML = ejeObject[this.value][1]
                }
                else {
                    ejeCell.innerHTML = ""
                    programaCell.innerHTML = ""
                }
                //display correct values
                for (var y in subprogramaObject[this.options[this.selectedIndex].text]) {
                    selectPartida.options[selectPartida.options.length] = new Option(y, y.split(" - ")[0]);
                }
            }

            selectPartida.onchange = function () {
                //empty biens dropdown
                selectBien.length = 1;
                // Fill Capítulo and Concepto from the left most digits of partida
                if (this.value) {
                    capituloCell.innerHTML = this.value[0] + "000"
                    conceptoCell.innerHTML = this.value[0] + this.value[1] + "00"
                }
                else {
                    capituloCell.innerHTML = ""
                    conceptoCell.innerHTML = ""
                }
                //display correct values
                var z = subprogramaObject[selectSubprograma.options[selectSubprograma.selectedIndex].text][this.options[this.selectedIndex].text];
                for (var i = 0; i < z.length; i++) {
                    selectBien.options[selectBien.options.length] = new Option(z[i], z[i].split(" - ")[0]);
                }
            }

            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<img style="width: 20px;height: 20px" src="images/trash.png" />';
            deleteButton.addEventListener('click', function(event) {
                const clickedButton = event.target;
                const row = clickedButton.parentNode.parentNode; 
                const table = row.parentNode; 
                table.removeChild(row);
            });

            newRow.appendChild(ejeCell);
            newRow.appendChild(programaCell);
            newRow.appendChild(subprogramaCell);
            newRow.appendChild(capituloCell);
            newRow.appendChild(conceptoCell);
            newRow.appendChild(partidaCell);
            newRow.appendChild(bienCell);
            newRow.appendChild(federalCell);
            newRow.appendChild(federalMunicipalCell);
            newRow.appendChild(estatalCell);
            newRow.appendChild(estatalMunicipalCell);
            newRow.appendChild(deleteButton);
            // Append the new row to the table body
            tableBody.appendChild(newRow);
            clickCount++;
        }
    </script>
    <style>
        select {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        th {
            padding-right: 20px;
        }

        input {
            width: 75px;
        }
    </style>
</body>

</html>